<main class="ride-page">
  <section class="ride-split">
    <aside class="map-panel" aria-label="Map panel">
      <div class="map-placeholder">
        <div class="map-placeholder-text">[Interactive Leaflet Map Integration]</div>
      </div>
    </aside>

    <section class="form-panel" aria-label="Ride request">
      <div class="ride-card">
        <h2 class="ride-title">Request Ride</h2>

        <form [formGroup]="form" class="ride-form">
          <div class="block">
            <div class="block-label">Pickup &amp; destinations (in order)</div>

            <div class="field" formGroupName="pickup">
              <input class="input" formControlName="address" placeholder="Pickup location" />
              <details class="advanced">
                <summary>Advanced coordinates</summary>
                <div class="advanced-grid">
                  <input class="input" type="number" step="0.000001" formControlName="latitude" placeholder="Latitude" />
                  <input class="input" type="number" step="0.000001" formControlName="longitude" placeholder="Longitude" />
                </div>
              </details>
            </div>

            <div class="stops" formArrayName="stops">
              <button class="ghost-btn" type="button" (click)="addStop()">Add Stop</button>

              <div class="stop" *ngFor="let stop of stops.controls; let i = index" [formGroupName]="i">
                <input class="input" formControlName="address" placeholder="Stop" />

                <details class="advanced">
                  <summary>Advanced coordinates</summary>
                  <div class="advanced-grid">
                    <input class="input" type="number" step="0.000001" formControlName="latitude" placeholder="Latitude" />
                    <input class="input" type="number" step="0.000001" formControlName="longitude" placeholder="Longitude" />
                  </div>
                </details>

                <button class="icon-btn" type="button" (click)="removeStop(i)" aria-label="Remove stop">Ã—</button>
              </div>
            </div>

            <div class="field" formGroupName="dropoff">
              <input class="input" formControlName="address" placeholder="Final destination" />
              <details class="advanced">
                <summary>Advanced coordinates</summary>
                <div class="advanced-grid">
                  <input class="input" type="number" step="0.000001" formControlName="latitude" placeholder="Latitude" />
                  <input class="input" type="number" step="0.000001" formControlName="longitude" placeholder="Longitude" />
                </div>
              </details>
            </div>
          </div>

          <div class="block">
            <div class="block-label">Linked passengers (emails)</div>
            <input
              class="input"
              formControlName="passengerEmails"
              placeholder="Enter emails separated by comma"
              autocomplete="email"
            />
          </div>

          <div class="row-2">
            <div class="block compact">
              <div class="block-label center">Vehicle type</div>
              <div class="segmented" role="group" aria-label="Vehicle type">
                <button
                  type="button"
                  class="seg-btn"
                  [class.active]="form.get('vehicleType')?.value === 'STANDARD'"
                  (click)="setVehicleType('STANDARD')"
                >
                  Standard
                </button>
                <button
                  type="button"
                  class="seg-btn"
                  [class.active]="form.get('vehicleType')?.value === 'VAN'"
                  (click)="setVehicleType('VAN')"
                >
                  Van
                </button>
                <button
                  type="button"
                  class="seg-btn"
                  [class.active]="form.get('vehicleType')?.value === 'LUX'"
                  (click)="setVehicleType('LUX')"
                >
                  Lux
                </button>
              </div>
            </div>

            <div class="block compact">
              <div class="block-label center">Schedule for later</div>
              <input
                class="input"
                type="datetime-local"
                formControlName="scheduledAt"
                [min]="scheduledMin"
                [max]="scheduledMax"
                step="60"
              />
            </div>
          </div>

          <div class="toggles">
            <label class="toggle">
              <input type="checkbox" formControlName="babyTransport" />
              <span>Baby Seat</span>
            </label>
            <label class="toggle">
              <input type="checkbox" formControlName="petTransport" />
              <span>Pet Friendly</span>
            </label>
          </div>

          <button
            class="primary"
            type="button"
            (click)="orderRide()"
          >
            Request Now
          </button>
          <button
            class="secondary"
            type="button"
            (click)="chooseFavoriteRoute()"
          >
            Choose Favorite Route
          </button>

          <button
            class="link"
            type="button"
            (click)="estimateRide()"
          >
            Estimate price
          </button>

          <p class="error" *ngIf="error">{{ error }}</p>

          <div class="result" *ngIf="estimate">
            <div class="result-row">
              <span>Estimated price</span>
              <strong>{{ estimate.estimatedPrice }} RSD</strong>
            </div>
            <div class="result-row">
              <span>Distance</span>
              <strong>{{ estimate.distanceKm }} km</strong>
            </div>
            <div class="result-row">
              <span>Duration</span>
              <strong>{{ estimate.estimatedDurationMinutes }} min</strong>
            </div>
          </div>

          <div class="result" *ngIf="orderResult">
            <div class="result-row">
              <span>Status</span>
              <strong>{{ orderResult.status }}</strong>
            </div>
            <div class="muted">{{ orderResult.message }}</div>
            <div class="muted" *ngIf="orderResult.rideId">Ride ID: {{ orderResult.rideId }}</div>
            <div class="muted" *ngIf="orderResult.assignedDriverEmail">Driver: {{ orderResult.assignedDriverEmail }}</div>
          </div>
        </form>
      </div>
    </section>
  </section>
</main>
